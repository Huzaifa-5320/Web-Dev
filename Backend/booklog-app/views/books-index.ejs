<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Huzaifa Ali — Books I've Read</title>
  <link rel="stylesheet" href="/styles.css">
</head>

<body>
  <header>
    <h1>Huzaifa Ali</h1>
    <p class="subtitle">Books I’ve Read</p>
  </header>

  <main>
    <a href="/add" class="btn" style="margin:20px; display:inline-block;">+ Add New Book</a>

    <ul class="grid">
      <% books.forEach(b=> { %>
        <li class="card">
          <% if (b.isbn13 || b.isbn10) { %>
            <img src="https://covers.openlibrary.org/b/isbn/<%= b.isbn13 || b.isbn10 %>-M.jpg?default=false"
              alt="Cover of <%= b.title %>" onerror="this.onerror=null;this.src='/images/no-cover.png';" />
            <% } else { %>
              <img src="/images/no-cover.png" alt="No cover available" />
              <% } %>

                <div class="meta">
                  <h3>
                    <%= b.title %>
                  </h3>
                  <p class="author">
                    <%= b.author %>
                  </p>

                  <% if (b.rating) { %>
                    <p class="rating">
                      <%= b.rating %>/10
                    </p>
                    <% } %>

                      <% if (b.notes && b.notes.trim().length> 0) { %>
                        <p class="notes-preview">
                          <%= b.notes.length> 100 ? b.notes.substring(0, 230) + '...' : b.notes %>
                        </p>
                        <% } %>
                </div>


                <div class="actions">
                  <% if (b.notes) { %>
                    <a href="/notes/<%= b.id %>" class="btn">Read Notes</a>
                    <% } %>
                      <a href="/edit/<%= b.id %>" class="btn">Edit</a>
                      <a href="/delete/<%= b.id %>" class="btn delete-link" data-title="<%= b.title %>">Delete</a>

                </div>

        </li>
        <% }) %>
    </ul>
  </main>
  <!-- Delete Modal -->
<div id="deleteModal" class="modal">
  <div class="modal-content">
    <h2>Confirm Delete</h2>
    <p id="modalMessage">Are you sure you want to delete this book?</p>
    <div class="modal-actions">
      <button type="button" id="cancelBtn" class="btn cancel">Cancel</button>
      <form id="deleteForm" method="POST" style="display:inline;">
        <button type="submit" class="btn delete">Delete</button>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const modal = document.getElementById("deleteModal");
  const cancelBtn = document.getElementById("cancelBtn");
  const deleteForm = document.getElementById("deleteForm");
  const modalMsg = document.getElementById("modalMessage");

  // Open modal
  document.querySelectorAll(".delete-link").forEach(link => {
    link.addEventListener("click", e => {
      e.preventDefault();
      const title = link.dataset.title || "this book";
      const url = link.getAttribute("href"); // /delete/:id

      modalMsg.textContent = `Are you sure you want to delete "${title}"?`;
      deleteForm.action = url;               // POST target
      modal.classList.add("show");           // show centered modal
    });
  });

  // Close modal
  function closeModal() { modal.classList.remove("show"); }
  cancelBtn.addEventListener("click", closeModal);
  window.addEventListener("click", e => { if (e.target === modal) closeModal(); });
  document.addEventListener("keydown", e => { if (e.key === "Escape") closeModal(); });
});
</script>


</body>

</html>